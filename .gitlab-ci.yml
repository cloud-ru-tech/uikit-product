include:
  - project: templates/pipelines
    ref: uikit
    file: /templates/lint/yarn_lint.yaml
  - project: templates/pipelines
    ref: v1.3.0
    file: /templates/lint/sonarqube.yaml
  - project: templates/pipelines
    ref: master
    file: /templates/build/yarn_build.yaml
  - project: templates/pipelines
    ref: v1.3.0
    file: /templates/image/kaniko_image.yaml
  - project: templates/pipelines
    ref: v1.3.0
    file: /templates/deploy/helm_deploy.yaml
  - project: templates/pipelines
    ref: uikit
    file: /templates/notification/slack_notify.yaml


stages:
- lint
- yarn-build
- image
- deploy
- notification

lint:
  before_script:
    - cat $NPMRC > .npmrc
  extends: .yarn-lint

lint-sonarqube:
  before_script:
    - cat $NPMRC > .npmrc
    - npm install
  extends: .sonarqube
  allow_failure: true

yarn-build:
  extends: .yarn-build
  variables:
    YARN_PREPACK: "true"

kaniko:image:
  before_script:
    - cat $NPMRC > .npmrc
  extends: .kaniko-image
  only:
    - develop

deploy:
  extends: .helm-deploy
  only:
    - develop
  variables:
    K8S_NAMESPACE: "uikit"
    K8S_CLUSTER_CONF: ${k8s_devops_test}

Notify fail:
  extends: .notify_fail_slack

Notify success:
  extends: .notify_success_slack
